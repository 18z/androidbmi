#summary 完成 BMI 程式
#labels tw

至此，我們已經完成了 bmi 程式的介面設計，並且理解了了新建立的程式。剩下我們要做的，只剩下為 BMI 程式加上程式邏輯囉。

很幸運的是，BMI 程式中用到的並不是什麼神秘的演算法，你甚至可以透過搜尋引擎找到中文的範例。


完整的程式如下：
{{{
1  package com.demo.android.bmi;
2
3  import java.text.DecimalFormat;
4
5  import android.app.Activity;
6  import android.os.Bundle;
7  import android.view.View;
8  import android.view.View.OnClickListener;
9  import android.widget.Button;
10 import android.widget.EditText;
11 import android.widget.TextView;
12
13 public class Bmi extends Activity {
14     /** Called when the activity is first created. */
15     @Override
16     public void onCreate(Bundle icicle) {
17         super.onCreate(icicle);
18         setContentView(R.layout.main);
19
20         //Listen for button clicks
21         Button button = (Button)findViewById(R.id.submit);
22         button.setOnClickListener(calcBMI);
23     }
24
25     private OnClickListener calcBMI = new OnClickListener()
26     {
27         public void onClick(View v)
28         {
29             DecimalFormat nf = new DecimalFormat("0.0");
30             EditText fieldheight = (EditText)findViewById(R.id.height);
31             EditText fieldweight = (EditText)findViewById(R.id.weight);
32             double height = Double.parseDouble(fieldheight.getText().toString())/100;
33             double weight = Double.parseDouble(fieldweight.getText().toString());
34             double BMI = weight / (height * height);
35
36             TextView result = (TextView)findViewById(R.id.result);
37             result.setText("Your BMI is "+nf.format(BMI));
38
39             //Give health advice
40             TextView fieldsuggest = (TextView)findViewById(R.id.suggest);
41             if(BMI>25){
42                 fieldsuggest.setText(R.string.advice_heavy);
43             }else if(BMI<20){
44                 fieldsuggest.setText(R.string.advice_light);
45             }else{
46                 fieldsuggest.setText(R.string.advice_average);
47             }
48         }
49     };
50 }
}}}


我們會學到：導入其他用到的模組、如何取得介面元件、如何對按鈕設定動作。

從上面的完整程式中，我們看到上面介紹到的程式主體都還在，不過也增加了一些內容。這些內容即我們的主要程式邏輯。


= 講解 =

{{{
//Listen for button clicks
}}}

兩個反斜線是 java 語言所支援的另一種註解方式。

{{{
Button button = (Button)findViewById(R.id.submit);
}}}

宣告一個 button 實體，透過 findViewById 方法，從資源檔中取得對應的介面元件。

R.id.submit 對應到 XML 描述檔的資源是
{{{
<Button id="@+id/submit"
/>
}}}
為了確保宣告的型別跟 XML 描述檔中描述的介面元件型別一致，好使程式運作正常，我們在 「indViewById」 方法前加上 「(Button)」修飾，強制將取得的資源型別設成 「button」型別。
{{{
button.setOnClickListener(new OnClickListener(){
});
}}}

這句包含了「 button.setOnClickListener」與其中的 「OnClickListener」兩個類別。
「setOnClickListener」是 button （按鈕）實體的方法。


< [AndroidLogic 解讀程式流程] | [DiveIntoAndroid 回目錄] | [BmiRefactor 重構程式] >